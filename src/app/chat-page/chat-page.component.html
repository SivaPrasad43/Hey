<div class="chat-wrapper">
  <div class="chat-container" 
       [class.ambience-happy]="ambienceMode === 'Happy'"
       [class.ambience-sad]="ambienceMode === 'Sad'"
       [class.ambience-angry]="ambienceMode === 'Angry'"
       [class.ambience-lovely]="ambienceMode === 'Lovely'">
    <div class="chat-header">
      <h1 class="chat-title">HeyðŸ‘‹</h1>
      <div class="dropdown">
        <img 
          class="profile-img dropdown-toggle" 
          id="dropdownMenuButton1" 
          data-bs-toggle="dropdown" 
          aria-expanded="false"
          src="https://cdn-icons-png.flaticon.com/512/149/149071.png" 
          alt="Profile">
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
          <li (click)="logout()" class="dropdown-item">
            <i class="fa-solid fa-arrow-right-from-bracket text-danger mr-3"></i>Logout
          </li>
        </ul>
      </div>
    </div>

    <div #chatBody class="chat-body" (scroll)="onScroll($event)">
      <ng-container *ngIf="isInitialLoad">
        <div class="skeleton-message" *ngFor="let i of [1,2,3,4,5]">
          <div class="skeleton-bubble">
            <div class="skeleton-line skeleton-line-short"></div>
            <div class="skeleton-line skeleton-line-long"></div>
            <div class="skeleton-line skeleton-line-medium"></div>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="!isInitialLoad">
        <ng-container *ngFor="let message of messages">
        <p *ngIf="message.isJoined && !message.text" class="system-message">
          <strong>{{message.userName}}</strong> joined the chat
        </p>
        <p *ngIf="!message.isJoined && !message.text" class="system-message">
          <strong>{{message.userName}}</strong> left the chat
        </p>

        <div *ngIf="message.text" class="message-row" [class.own]="message.senderId === userId">
          <div class="message-bubble" 
               [class.own]="message.senderId === userId"
               [class.happy]="message.mode === 'Happy'"
               [class.sad]="message.mode === 'Sad'"
               [class.angry]="message.mode === 'Angry'"
               [class.lovely]="message.mode === 'Lovely'">
            <div class="message-emoji">{{message.emoji}}</div>
            <div class="message-sender">{{message.senderId === userId ? 'You' : message.sender}}</div>
            <div class="message-text">{{message.text}}</div>
            <div class="message-time">{{message.time}}</div>
          </div>
        </div>
      </ng-container>
      </ng-container>
    </div>

    <button *ngIf="showScrollButton" class="scroll-to-bottom-btn" (click)="scrollToBottom()">
      <i class="fa-solid fa-arrow-down"></i>
    </button>

    <div class="chat-input-area">
      <div class="input-wrapper">
        <textarea 
          class="message-input"
          [(ngModel)]="message"
          (keydown.enter)="handleEnter($event)"
          (input)="autoResize($event)"
          autocomplete="off"
          placeholder="Type a message..."
          rows="1"></textarea>

        <div class="emoji-selector">
          <div class="emoji-options">
            <button
              *ngFor="let emoji of emojiList"
              [hidden]="emoji.mode === emojiMode.mode"
              (click)="setEmoji(emoji)"
              class="emoji-option"
              type="button">
              {{emoji.emoji}}
            </button>
          </div>
          <button 
            class="emoji-btn"
            [class.happy]="emojiMode.mode === 'Happy'"
            [class.sad]="emojiMode.mode === 'Sad'"
            [class.angry]="emojiMode.mode === 'Angry'"
            [class.lovely]="emojiMode.mode === 'Lovely'"
            type="button">
            {{emojiMode.emoji}}
          </button>
        </div>

        <button 
          *ngIf="message" 
          class="send-btn" 
          (click)="sendMsg()"
          type="button">
          <i class="fa-solid fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>
